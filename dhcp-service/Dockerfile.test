FROM ruby:3.3.6-alpine3.20

RUN apk add bash build-base curl mysql mysql-client mysql-dev && \
  curl -1sLf 'https://dl.cloudsmith.io/public/isc/kea-2-6/setup.alpine.sh' | bash && \
  apk update &&  \
  apk upgrade && \
  apk add build-base mysql-dev isc-kea-admin isc-kea-perfdhcp isc-kea-dhcp4 isc-kea-ctrl-agent isc-kea-hook-lease-cmds isc-kea-hook-stat-cmds isc-kea-hook-ha && \
  apk add isc-kea-perfdhcp tshark && \
  rm -rf /var/cache/apk/*

RUN chown root:root /usr/bin/dumpcap

WORKDIR /test

COPY ./metrics ./metrics
COPY ./spec ./spec

RUN cd metrics && \
  bundle config set no-cache 'true' && \
  bundle install
